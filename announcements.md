# Announcements (Latest News) module

This is a lightweight feed so DSA/counselling updates reach every student, including guests (no login needed). Data lives locally in SQLite and is synced to Supabase so all devices see the same posts.

## What the code does
- Model: `lib/models/announcement.dart` (title, summary, body, author, category, publishedAt).
- Storage: SQLite table `announcements` (DbService v9) with insert/list/delete and bulk replace.
- Sync: `lib/services/announcement_service.dart`
  - On load: tries to fetch from Supabase `announcements` table, caches locally, falls back to local cache, then seeds 2 starter posts if empty.
  - On publish: saves locally and attempts Supabase upsert; can also trigger a local notification.
  - Notifications: `NotificationService.showAnnouncementAlert` shows a push alert with title + summary/body snippet.
- UI: `lib/pages/announcements_page.dart`
  - Lists posts, shows detail sheet, and has a simple composer (title, summary/body, author/category, optional notification toggle).
  - Home tile “Latest news” opens this page; route `/announcements`.

## Supabase setup
Add this table (see `sql.md` for full statement):
```sql
create table public.announcements (
  id bigint generated by default as identity primary key,
  title text not null,
  summary text not null,
  body text not null,
  author text not null default 'DSA Wellness Desk',
  category text,
  published_at timestamptz not null default now()
);
```
Enable RLS and allow public reads so guests can fetch:
```sql
alter table public.announcements enable row level security;
create policy "Announcements are readable by anyone" on public.announcements
  for select using (true);
```
Optionally let the app insert (if you want in-app posting to sync):
```sql
create policy "Announcements can be added from app" on public.announcements
  for insert with check (true);
```
Keep deletes restricted to trusted roles.

## How it flows (guest-friendly)
1) App opens Latest News → `AnnouncementService.loadAnnouncements()` tries Supabase fetch → caches to SQLite → displays.
2) If offline: falls back to cached posts (seeded on first load).
3) When creating a post in-app: saves locally, attempts Supabase upsert; if enabled, a local notification is shown immediately on that device.
4) Next launch or pull-to-refresh: other devices fetch the shared Supabase list, so guests see the same updates.

## Accessibility & safety notes
- Copy should stay gentle, non-clinical, and include helplines when relevant.
- Composer encourages short summaries to avoid overflow; detail view wraps text and scrolls on small screens.
