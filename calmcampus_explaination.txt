CalmCampus – Current Feature Overview

Audience: Bernard / project collaborators
Scope: What exists today (Flutter app + Supabase + push relay) and how to use it.

--------------------------------------------------
1) Access, Roles, and Onboarding
- Supabase auth with student signup (student email enforced) and admin accounts created by webmaster; role cached locally.
- Role gate: redirects admins to Admin Dashboard, students to main nav.
- Onboarding: first-run intro screen; per-page floating guides on Home, Mood, and Tasks explaining how to use the page (Next/Finish, one-time per device).
- Reset/forgot password: email-only reset page, deep link calmcampus://login-callback (Android intent-filter + iOS URL scheme), in-app reset flow.

2) Home
- Grid of feature cards (mood, announcements, journal, profile, timetable, tasks, chat/buddy, relax, sleep, movement, period, support plan, consultation, help, DSA summary, challenges).
- Admins auto-redirected to Admin Dashboard. Login/profile shortcuts stay in sync.

3) Mood, Sleep, Period, Movement
- MoodPage: pick mood (emoji/label), main tag, optional note; history list with filters; local SQLite storage.
- Sleep: manual and “sleep session” logging with restfulness; history and simple insights tying sleep to mood.
- Period tracker: manual start/end, average cycle/duration, predicted next period and ovulation window; gentle copy; no sharing with admins.
- Movement: quick log with type/intensity/energy before/after; weekly summary.

4) Tasks, Timetable, Support
- Tasks: add/edit/delete, pending/completed views, reorderable custom sort, filters/sorts, per-page guide for usage.
- Timetable: classes with lecturer/type/location/time; reminders supported; upcoming highlight implemented.
- Support Plan: save “safe people” contacts and expose quick actions in HelpNow.
- HelpNow: crisis disclaimer, DSA contact, mentor suggestion, hotlines; linked from Home and other flows.
- Common Challenges: content pages with validation, small steps, links to HelpNow/Relax/Buddy.

5) Relax, Breathing, Audio
- Relax page with ambient + guided tracks; dual-player with independent volumes and floating controls.
- Breathing exercises with visual pacing and session guidance.
- Audio assets registered in pubspec; custom launcher icon in place.

6) Admin Module and Consultation
- Admin Dashboard with shortcuts to announcements, consultation inbox, mood analytics, and availability toggle (consultant online).
- Consultation: students start sessions with online consultants; admins reply/end sessions; chat uses Supabase stream plus 1s polling for reliability; messages purged on session end.
- Admin profile page edits Supabase profile (no SQLite).

7) Announcements
- Admin-only publish/delete in app; students view and can hide per-user.
- Incremental fetch for students (announcement_reads/announcement_hides tables); avoids reloading old posts and respects per-user hides.
- Push notifications: app subscribes to announcements + role topics; tokens upserted to fcm_tokens with role.
- Announcement pushes sent via push relay (`/notify/announcement` topic=announcements).

8) Analytics and Exports
- Admin mood analytics: pie chart for 3/7/30 days; export CSV and text “PDF” with timestamp.
- History export: students can export mood history CSV.
- Consultation sessions ephemeral; no export by design.

9) Push Relay and Backend Services
- Node push relay on port 3002 by default (`npm run start:push`, set PORT/GOOGLE_APPLICATION_CREDENTIALS/FCM_TOPIC). Supports `/notify/announcement` (topic) and `/notify/token` (direct) with logging.
- AI buddy server on port 3001; confirm page static host on port 3000; adjust PUSH_BASE_URL to http://bernard.onthewifi.com:3002 for app builds.
- App defaults: fallback push URL points to 3002; override with --dart-define=PUSH_BASE_URL=...

10) Routing and Deep Links
- Routes include onboarding, auth, reset-request, reset-password, role-gate home, student shell, admin dashboard, consultation pages, admin profile, admin mood analytics, and all feature pages.
- Android intent-filter and iOS URL scheme for `calmcampus://login-callback` used in password recovery.

11) Data Storage (local)
- SQLite tables: moods, classes, tasks, journal entries, sleep_entries, period_cycles, support_contacts, movement_entries, announcements (local cache).
- SharedPreferences: first-run flag, nickname/course/year, theme, language, timetable reminder toggle, chat note flag, role/display name/consultant/online flags, sleep session state.

12) Current gaps / optional work
- Onboarding/profile setup (basic profile form still optional).
- Optional task filters by subject/due date (partially covered by current filters/sorts).
- Optional cycle hints on Home.
- Testing/presentation assets (screenshots, demo script, report sections).
- Anonymous campus pulse and movement/sleep insights beyond current summaries are optional/future.

How to start services (recommended ports)
- Confirm page (web/confirm): npx http-server . -p 3000
- AI buddy server: PORT=3001 npm start (ai-buddy-server)
- Push relay: PORT=3002 npm run start:push (with GOOGLE_APPLICATION_CREDENTIALS set)
- Flutter app run/build: --dart-define=PUSH_BASE_URL=http://bernard.onthewifi.com:3002
